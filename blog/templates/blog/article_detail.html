{% extends 'base.html' %}
{% load static %}

{% block title %}{{ article.title }}{% endblock %}

{% block extra_css %}
<style>
    .comment-card {
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
    }
    .comment-card:hover {
        transform: translateY(-2px);
    }
    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Article Content -->
    <h1 class="mb-3">{{ article.title }}</h1>
    <p class="text-muted">Publié le {{ article.created_at|date:"d M Y" }} par {{ article.author.username }}</p>
    <div class="mb-4">
        {% if article.image %}
            <img src="{{ article.image.url }}" alt="{{ article.title }}" class="img-fluid rounded mb-3" style="max-height: 400px; object-fit: cover;">
        {% endif %}
        <div>{{ article.content|safe }}</div>
    </div>

    <!-- Comments Section -->
    <h3 class="mb-4">Commentaires ({{ article.comments.count }})</h3>
    {% if article.comments.all %}
        {% for comment in article.comments.all %}
            <div class="card comment-card mb-3 p-3">
                <div class="d-flex align-items-start">
                    <!-- Avatar (if available) -->
                    <img src="{% if comment.user.profile.avatar %}{{ comment.user.profile.avatar.url }}{% else %}https://via.placeholder.com/40{% endif %}" alt="{{ comment.user.username }}" class="avatar me-3">
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <h6 class="mb-1">{{ comment.user.username }}</h6>
                            <small class="text-muted">{{ comment.created_at|date:"d M Y H:i" }}</small>
                        </div>
                        <p class="mb-0">{{ comment.content }}</p>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Aucun commentaire pour le moment. Soyez le premier à commenter !</p>
    {% endif %}

    <!-- Add Comment Button -->
    {% if user.is_authenticated %}
        <a href="{% url 'blog:add_comment' article.id %}" class="btn btn-primary mt-3"><i class="fas fa-comment-alt me-2"></i>Ajouter un commentaire</a>
    {% else %}
        <p class="text-muted mt-3">Vous devez être <a href="{% url 'users:login' %}?next={{ request.path }}">connecté</a> pour ajouter un commentaire.</p>
    {% endif %}
</div>
{% endblock %}