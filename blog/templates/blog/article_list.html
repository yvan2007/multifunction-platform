{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="product_section layout_padding">
    <div class="container">
        <div class="heading_container heading_center">
            <h2>Articles du Blog</h2>
        </div>
        <div class="row" id="article-list">
            {% for article in articles %}
            <div class="col-sm-6 col-md-4 col-lg-4">
                <div class="box">
                    <div class="img-box">
                        {% if article.image %}
                            <img src="{{ article.image.url }}" alt="{{ article.title }}">
                        {% else %}
                            <img src="{% static 'images/blog_banner.png' %}" alt="{{ article.title }}">
                        {% endif %}
                    </div>
                    <div class="detail-box">
                        <h5><a href="{% url 'blog:article_detail' article.slug %}">{{ article.title }}</a></h5>
                        <p>{{ article.content|safe|truncatewords:20 }}</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Aucun article disponible pour le moment.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    function refreshArticles() {
        fetch('{% url "blog:blog" %}')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const newArticleList = doc.querySelector('#article-list');
                document.querySelector('#article-list').innerHTML = newArticleList.innerHTML;
            })
            .catch(error => console.error('Erreur lors du rafraîchissement:', error));
    }

    // Rafraîchir toutes les 10 secondes
    setInterval(refreshArticles, 10000);
</script>
{% endblock %}