{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_list.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Image du produit -->
        <div class="col-md-6">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid" style="max-height: 400px; object-fit: cover;">
            {% else %}
                <img src="https://via.placeholder.com/400" alt="Image par défaut" class="img-fluid" style="max-height: 400px; object-fit: cover;">
            {% endif %}
        </div>
        <!-- Détails du produit -->
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <p><strong>Catégorie :</strong> {{ product.category.name }}</p>
            <p><strong>Prix :</strong> {{ product.price }} €</p>
            <p><strong>Description :</strong> {{ product.description }}</p>
            <form method="post" action="{% url 'ecommerce:add_to_cart' product.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">Ajouter au panier</button>
            </form>
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'users:favorites' %}" class="mt-2">
                    {% csrf_token %}
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    {% if is_favorited %}
                        <input type="hidden" name="action" value="remove">
                        <button type="submit" class="btn btn-danger">Retirer des favoris</button>
                    {% else %}
                        <input type="hidden" name="action" value="add">
                        <button type="submit" class="btn btn-success">Ajouter aux favoris</button>
                    {% endif %}
                </form>
            {% endif %}
        </div>
    </div>
    <!-- Produits associés -->
    {% if related_products %}
        <h2 class="mt-5">Produits associés</h2>
        <div class="row">
            {% for related_product in related_products %}
                <div class="col-md-3 mb-4">
                    <div class="card h-100">
                        {% if related_product.image %}
                            <img src="{{ related_product.image.url }}" alt="{{ related_product.name }}" class="card-img-top" style="height: 150px; object-fit: cover;">
                        {% else %}
                            <img src="https://via.placeholder.com/150" alt="Image par défaut" class="card-img-top" style="height: 150px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ related_product.name }}</h5>
                            <p class="card-text">{{ related_product.price }} €</p>
                            <a href="{% url 'ecommerce:product_detail' related_product.slug %}" class="btn btn-primary">Voir les détails</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}