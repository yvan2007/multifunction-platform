{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_list.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    .thumbnail-img {
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
    }
    .main-image {
        max-height: 400px;
        object-fit: cover;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Thumbnails -->
        <div class="col-md-2">
            {% for image in product.images.all %}
                <img src="{{ image.image.url }}" class="thumbnail-img mb-2" alt="{{ image.alt_text|default:product.name }}" onclick="document.getElementById('main-image').src=this.src;">
            {% endfor %}
        </div>
        <!-- Image du produit -->
        <div class="col-md-4">
            {% if product.primary_image %}
                <img id="main-image" src="{{ product.primary_image.image.url }}" alt="{{ product.primary_image.alt_text|default:product.name }}" class="img-fluid main-image rounded">
            {% else %}
                <img id="main-image" src="https://via.placeholder.com/400" alt="Image par défaut" class="img-fluid main-image rounded">
            {% endif %}
        </div>
        <!-- Détails du produit -->
        <div class="col-md-6">
            <h1>{{ product.name }}</h1>
            <p><strong>Catégorie :</strong> {{ product.category.name }}</p>
            <p><strong>Prix :</strong> {{ product.price }} FCFA</p>
            <p><strong>Description :</strong> {{ product.description }}</p>
            <form method="post" action="{% url 'ecommerce:add_to_cart' product.id %}" class="mb-3">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="quantity" class="form-label">Quantité</label>
                    <input type="number" id="quantity" name="quantity" class="form-control w-25" value="1" min="1">
                </div>
                <button type="submit" class="btn btn-primary">Ajouter au panier</button>
            </form>
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'ecommerce:toggle_favorite' product.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link p-0">
                        <i class="fa {% if is_favorited %}fa-heart text-danger{% else %}fa-heart-o{% endif %}" style="font-size: 1.5rem;"></i>
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
    <!-- Produits associés -->
    {% if related_products %}
        <h2 class="mt-5">Produits associés</h2>
        <div class="row">
            {% for related_product in related_products %}
                <div class="col-md-3 mb-4">
                    <div class="card h-100">
                        {% if related_product.primary_image %}
                            <img src="{{ related_product.primary_image.image.url }}" alt="{{ related_product.primary_image.alt_text|default:related_product.name }}" class="card-img-top" style="height: 150px; object-fit: cover;">
                        {% else %}
                            <img src="https://via.placeholder.com/150" alt="Image par défaut" class="card-img-top" style="height: 150px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ related_product.name }}</h5>
                            <p class="card-text">{{ related_product.price }} FCFA</p>
                            <a href="{% url 'ecommerce:product_detail' related_product.slug %}" class="btn btn-primary">Voir les détails</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}